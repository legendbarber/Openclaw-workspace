<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‹¹ì¼ ì£¼ë„í…Œë§ˆ/ì£¼ë„ì£¼</title>
  <style>
    body{margin:0;background:#0b1220;color:#e5e7eb;font-family:Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:#111827;border:1px solid #1f2937;border-radius:14px;padding:14px;margin-top:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}
    .muted{color:#9ca3af}
    button{background:#2563eb;border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    a{color:#93c5fd}
    .pill{display:inline-block;border:1px solid #374151;border-radius:999px;padding:3px 8px;font-size:12px;margin-right:6px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ”¥ ë‹¹ì¼ ì£¼ë„í…Œë§ˆ Â· ì£¼ë„ì£¼</h1>
  <div class="muted">í…Œë§ˆ ê°•ë„ + í…Œë§ˆ ë‚´ ì£¼ë„ì£¼ ì ìˆ˜ë¡œ ë‹¹ì¼ íë¦„ì„ ë¹ ë¥´ê²Œ í™•ì¸</div>
  <button onclick="load()">ìƒˆë¡œ ê³„ì‚°</button>
  <div id="meta" class="card"></div>
  <div id="themes" class="row"></div>
  <div id="leaders" class="card"></div>
</div>
<script>
const fmt=(v,d=2)=> (v===null||v===undefined)?'-':Number(v).toLocaleString(undefined,{maximumFractionDigits:d});
const pct=v=>`${v>0?'+':''}${fmt(v,2)}%`;

async function load(){
  const r = await fetch(`/api/theme-leaders?limit=12&pick=2&t=${Date.now()}`, {cache:'no-store'});
  const d = await r.json();
  if(!r.ok){
    document.getElementById('meta').innerHTML = `<b>ì˜¤ë¥˜:</b> ${d.message||d.error||'unknown'}`;
    return;
  }

  document.getElementById('meta').innerHTML = `
    <b>ê¸°ì¤€ì¼:</b> ${d.date || '-'}<br>
    <b>ìƒì„±ì‹œê°:</b> ${new Date(d.generatedAt).toLocaleString()}<br>
    <b>ë¡œì§:</b> ${d.methodology}
  `;

  const topThemes = (d.themes||[]).slice(0,8);
  document.getElementById('themes').innerHTML = topThemes.map((t,idx)=>{
    const l = t.leaders?.[0] || {};
    return `<div class='card'>
      <b>#${idx+1} ${t.title}</b><br>
      <span class='pill'>í…Œë§ˆì ìˆ˜ ${fmt(t.themeScore)}</span>
      <span class='pill'>ìƒìŠ¹ì¢…ëª©ë¹„ìœ¨ ${fmt(t.breadthPct)}%</span>
      <span class='pill'>ê±°ë˜í•© ${fmt(t.tradeSum,0)}</span>
      <hr style='border-color:#1f2937'>
      <div><b>ëŒ€í‘œ ì£¼ë„ì£¼:</b> ${l.name||'-'} (${l.code||'-'})</div>
      <div>ë“±ë½ë¥  ${pct(l.changeRatePct||0)} Â· ê±°ë˜ëŒ€ê¸ˆ ${fmt(l.tradeValue,0)} Â· ë¦¬ë”ì ìˆ˜ ${fmt(l.leadershipScore)}</div>
      ${l.chartUrl?`<div><a target='_blank' href='${l.chartUrl}'>ì°¨íŠ¸ ë³´ê¸°</a></div>`:''}
    </div>`;
  }).join('');

  const topLeaders = (d.leaders||[]).slice(0,15);
  document.getElementById('leaders').innerHTML = `<b>ì£¼ë„ì£¼ TOP 15</b><br><br>` + topLeaders.map((x,i)=>
    `${i+1}. ${x.name} (${x.code}) - ${x.themeTitle} | ë¦¬ë”ì ìˆ˜ ${fmt(x.leadershipScore)} | ë“±ë½ ${pct(x.changeRatePct)} | ê±°ë˜ ${fmt(x.tradeValue,0)}`
  ).join('<br>');
}
load();
</script>
</body>
</html>
