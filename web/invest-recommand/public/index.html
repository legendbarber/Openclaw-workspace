<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invest Recommand</title>
  <style>
    body{margin:0;background:#0b1220;color:#e5e7eb;font-family:Arial,sans-serif}
    .wrap{max-width:1000px;margin:0 auto;padding:20px}
    .card{background:#111827;border:1px solid #1f2937;border-radius:14px;padding:16px;margin-top:12px}
    .big{font-size:28px;font-weight:700}
    .muted{color:#9ca3af}
    button{background:#2563eb;border:0;color:#fff;padding:9px 12px;border-radius:8px;cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}
    a{color:#93c5fd}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ¯ Invest Recommand</h1>
    <div class="muted">ìƒìœ„ 5ê°œ íˆ¬ììƒí’ˆ ì¶”ì²œ (í•©ì˜+ëª¨ë©˜í…€+êµ°ì¤‘ì‹ í˜¸)</div>
    <button onclick="loadData()">ìƒˆë¡œ ì¡°íšŒ</button>

    <div id="meta" class="card"></div>
    <div id="notrade" class="card" style="display:none"></div>
    <div id="top" class="card"></div>
    <div id="top5" class="row"></div>
    <div id="breakdown" class="row"></div>
  </div>

<script>
function fmt(v,d=2){return (v===null||v===undefined)?'-':Number(v).toLocaleString(undefined,{maximumFractionDigits:d});}

async function loadData(){
  const res = await fetch('/api/report');
  const d = await res.json();

  document.getElementById('meta').innerHTML = `
    <b>ìƒì„±ì‹œê°:</b> ${new Date(d.generatedAt).toLocaleString()}<br>
    <b>ëª¨ë¸:</b> ${d.model}<br>
    <b>ì ìˆ˜ì‹:</b> ${d.methodology}
  `;

  const notrade = document.getElementById('notrade');
  if(d.noTrade){
    notrade.style.display='block';
    notrade.innerHTML = `<b>ì˜¤ëŠ˜ì€ ê´€ë§ ê¶Œì¥</b><br>${d.noTradeReason || ''}`;
  }else{
    notrade.style.display='none';
    notrade.innerHTML='';
  }

  const x = d.topPick;
  if(!x){
    document.getElementById('top').innerHTML = 'ì¶”ì²œ í›„ë³´ ì—†ìŒ';
    document.getElementById('top5').innerHTML = '';
    document.getElementById('breakdown').innerHTML = '';
    return;
  }

  document.getElementById('top').innerHTML = `
    <div class='big'>Top Pick: ${x.symbol} (${x.name})</div>
    <div>ì¹´í…Œê³ ë¦¬: ${x.category} / ì¢…í•©ì ìˆ˜: <b>${fmt(x.score)}</b></div>
    <div>í˜„ì¬ê°€: ${fmt(x.currentPrice)}</div>
    <hr>
    <div><b>ìš´ìš© ê³„íš</b></div>
    <div>ì§„ì…ê°€: ${fmt(x.plan.entryZone[0])} ~ ${fmt(x.plan.entryZone[1])}</div>
    <div>ì†ì ˆê°€: ${fmt(x.plan.stopLoss)} / 1ì°¨ ìµì ˆ: ${fmt(x.plan.takeProfit1)} / 2ì°¨ ìµì ˆ: ${fmt(x.plan.takeProfit2)}</div>
    <div>ìœ íš¨ê¸°ê°„: ${x.plan.ttlTradingDays}ê±°ë˜ì¼</div>
    <div>ë¬´íš¨í™” ì¡°ê±´: ${x.plan.invalidationRule}</div>
    <div style='margin-top:8px'>
      <a href='${x.links.yahoo}' target='_blank'>Yahoo</a> Â·
      <a href='${x.links.analysis}' target='_blank'>Analysis</a> Â·
      <a href='${x.links.news}' target='_blank'>News</a>
    </div>
  `;

  const top5 = (d.rankings || []).slice(0,5);
  document.getElementById('top5').innerHTML = top5.map((r, idx) => `
    <div class='card'>
      <b>#${idx+1} ${r.symbol} (${r.name})</b><br>
      ì ìˆ˜: ${fmt(r.score)} / í˜„ì¬ê°€: ${fmt(r.currentPrice)}<br>
      ì§„ì…: ${fmt(r.plan.entryZone[0])}~${fmt(r.plan.entryZone[1])}<br>
      ì†ì ˆ: ${fmt(r.plan.stopLoss)} / ìµì ˆ1: ${fmt(r.plan.takeProfit1)}
    </div>
  `).join('');

  const c = x.components;
  document.getElementById('breakdown').innerHTML = `
    <div class='card'>
      <b>R) ë¦¬í¬íŠ¸/ê¸°ê´€ í•©ì˜</b><br>
      ì ìˆ˜: ${fmt(c.reportConsensus.score)}<br>
      ëª©í‘œê°€ ê´´ë¦¬: ${fmt(c.reportConsensus.upsidePct)}%<br>
      ì¶”ì²œì§€ìˆ˜: ${fmt(c.reportConsensus.recommendationMean)} / ì˜ê²¬ìˆ˜: ${fmt(c.reportConsensus.analystOpinions,0)}
    </div>
    <div class='card'>
      <b>M) ê°€ê²© ëª¨ë©˜í…€</b><br>
      ì ìˆ˜: ${fmt(c.momentum.score)}<br>
      1M: ${fmt(c.momentum.m1Pct)}% / 3M: ${fmt(c.momentum.m3Pct)}% / 6M: ${fmt(c.momentum.m6Pct)}%
    </div>
    <div class='card'>
      <b>C) êµ°ì¤‘/ë‰´ìŠ¤ ì‹œê·¸ë„</b><br>
      ì ìˆ˜: ${fmt(c.crowd.score)} / í†¤: ${fmt(c.crowd.tone,0)} / í—¤ë“œë¼ì¸: ${fmt(c.crowd.headlineCount,0)}ê°œ
      <ul>${(c.crowd.headlines||[]).map(h=>`<li>${h}</li>`).join('')}</ul>
    </div>
    <div class='card'>
      <b>L+V) ìœ ë™ì„±/ë¦¬ìŠ¤í¬</b><br>
      ìœ ë™ì„± ì ìˆ˜: ${fmt(c.liquidityScore)}<br>
      ë¦¬ìŠ¤í¬ ì ìˆ˜: ${fmt(c.risk.score)} / ë³€ë™ì„±: ${fmt(c.risk.volPct)}% / ìµœëŒ€ë‚™í­: ${fmt(c.risk.maxDrawdownPct)}%
    </div>
  `;
}

loadData();
</script>
</body>
</html>
