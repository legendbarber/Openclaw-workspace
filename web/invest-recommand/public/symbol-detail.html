<!doctype html><html lang='ko'><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>종목 상세 근거</title><style>body{margin:0;background:#111315;color:#e5e7eb;font-family:Inter,Arial,sans-serif}.wrap{max-width:1100px;margin:auto;padding:20px}.card{background:#1a1d21;border:1px solid #2b3138;border-radius:12px;padding:14px;margin-top:12px}.muted{color:#9aa4b2}a{color:#cbd5e1}.h{font-size:28px;font-weight:700}.chartbox{height:360px;min-height:360px;background:#0f172a;border:1px solid #24304f;border-radius:10px;padding:6px;overflow:hidden}</style></head><body><div class='wrap'><div><a href='/invest-recommend'>← 메인으로</a></div><div id='head' class='card'>불러오는 중...</div><div id='quick' class='card'></div><div id='chart' class='card'><b>가격 차트 (캔들+거래량+MA20/60)</b><div id='chartArea' class='chartbox' style='margin-top:8px'></div></div><div id='plan' class='card'></div><div id='reasons' class='card'></div></div><script>function fmt(v,d=2){return (v===null||v===undefined)?'-':Number(v).toLocaleString(undefined,{maximumFractionDigits:d});}function pct(v,d=2){if(v===null||v===undefined||Number.isNaN(Number(v)))return '-';const n=Number(v);const s=n>0?'+':'';return `${s}${n.toLocaleString(undefined,{maximumFractionDigits:d})}%`;}function getSymbol(){const parts=location.pathname.split('/');return decodeURIComponent(parts[parts.length-1]||'').toUpperCase();}function longExplain(r){const c=r.components||{};const rc=c.reportConsensus||{};const t=c.technical||{};const m=c.momentum||{};const risk=c.risk||{};const crowd=c.crowd||{};const liq=c.liquidityScore;return `
<b>1) 리포트/기관 합의 (R)</b><br>
- 합의점수: ${fmt(rc.score)}점<br>
- 목표가 괴리: ${pct(rc.upsidePct)}<br>
- 추천지수/의견수: ${fmt(rc.recommendationMean)} / ${fmt(rc.analystOpinions,0)}<br><br>
<b>2) 기술적 타이밍 (T)</b><br>
- 기술점수: ${fmt(t.score)}점 (셋업: ${t.setup||'-'})<br>
- RSI(14): ${fmt(t.rsi14)} / MA20 이격: ${pct(t.distMa20Pct)} / 20일고점대비: ${pct(t.from20dHighPct)}<br><br>
<b>3) 모멘텀 (M, 참고)</b><br>
- 1M: ${pct(m.m1Pct)} · 3M: ${pct(m.m3Pct)} · 6M: ${pct(m.m6Pct)}<br>
- 모멘텀 점수: ${fmt(m.score)}점<br><br>
<b>4) 리스크/유동성 (V/L)</b><br>
- 유동성 점수: ${fmt(liq)}점<br>
- 변동성: ${pct(risk.volPct)} / 최대낙폭(MDD): ${pct(risk.maxDrawdownPct)} / 리스크점수: ${fmt(risk.score)}<br><br>
<b>5) 군중/뉴스 (C)</b><br>
- 점수: ${fmt(crowd.score)} / 톤: ${fmt(crowd.tone,0)} / 헤드라인 수: ${fmt(crowd.headlineCount,0)}
`;}
function easyExplain(r){const c=r.components||{};const t=c.technical||{};const rc=c.reportConsensus||{};const rr=Number(r.riskReward||0);let tone='중립';if(rr>=4&&Number(t.score||0)>=60)tone='공격적 매수 우위';else if(rr>=3)tone='매수 우위';else tone='관망/분할 접근';return `
<b>왜 지금 진입 후보인가? (쉽게)</b><br>
- 목표수익 대비 손실비율(RR)이 <b>${fmt(rr)}</b>로 유리한 편이고,<br>
- 기술적 구조가 <b>${t.setup||'확인 필요'}</b> 구간이라 리스크 관리가 비교적 명확함.<br>
- 기관/리포트 합의도 ${fmt(rc.score)}점으로 받쳐주고 있어 <b>${tone}</b> 판단.
`;}
function renderBigCandles(d,el){const o=d.open.map(Number),h=d.high.map(Number),l=d.low.map(Number),c=d.close.map(Number),v=(d.volume||[]).map(Number);const m=o.length;if(!m){el.innerHTML='데이터 없음';return;}const sma=(arr,p)=>arr.map((_,i)=>i<p-1?null:arr.slice(i-p+1,i+1).reduce((a,b)=>a+b,0)/p);const ma20=sma(c,20),ma60=sma(c,60);const all=[...h,...l].filter(Number.isFinite);const w=940,hPx=340,pL=8,pR=52,pT=8,pB=14,volH=74,priceH=hPx-pT-pB-volH-8,plotW=w-pL-pR;const minRaw=Math.min(...all),maxRaw=Math.max(...all),pad=(maxRaw-minRaw)*0.06,min=minRaw-pad,max=maxRaw+pad,span=(max-min)||1;const y=v=>pT+(max-v)/span*priceH;const volTop=pT+priceH+8,maxVol=Math.max(...v.filter(Number.isFinite),1),slot=plotW/(m||1),bodyW=Math.max(2,Math.min(8,slot*0.62));const grid=[];for(let i=0;i<=4;i++){const gy=pT+(priceH/4)*i;grid.push(`<line x1='${pL}' y1='${gy}' x2='${w-pR}' y2='${gy}' stroke='#24304f'/>`);}const wick=[],body=[],vols=[];for(let i=0;i<m;i++){const cx=pL+slot*i+slot/2,oy=y(o[i]),cy=y(c[i]),hy=y(h[i]),ly=y(l[i]),up=c[i]>=o[i],color=up?'#22c55e':'#ef4444';wick.push(`<line x1='${cx}' y1='${hy}' x2='${cx}' y2='${ly}' stroke='${color}'/>`);body.push(`<rect x='${cx-bodyW/2}' y='${Math.min(oy,cy)}' width='${bodyW}' height='${Math.max(Math.abs(cy-oy),1.2)}' fill='${color}'/>`);const vv=Number.isFinite(v[i])?v[i]:0,vh=(vv/maxVol)*volH;vols.push(`<rect x='${cx-bodyW/2}' y='${volTop+(volH-vh)}' width='${bodyW}' height='${Math.max(vh,0.8)}' fill='${up?'#1f9d55':'#b91c1c'}' opacity='0.75'/>`);}const path=a=>a.map((x,i)=>Number.isFinite(x)?`${pL+slot*i+slot/2},${y(x)}`:'').filter(Boolean).join(' ');el.innerHTML=`<svg viewBox='0 0 ${w} ${hPx}' width='100%' height='340'><rect x='0' y='0' width='${w}' height='${hPx}' fill='#0f172a' rx='8'/>${grid.join('')}${wick.join('')}${body.join('')}<polyline fill='none' stroke='#f59e0b' stroke-width='1.4' points='${path(ma20)}'/><polyline fill='none' stroke='#60a5fa' stroke-width='1.4' points='${path(ma60)}'/><line x1='${pL}' y1='${volTop-1}' x2='${w-pR}' y2='${volTop-1}' stroke='#24304f'/>${vols.join('')}<text x='${w-pR+5}' y='${pT+10}' fill='#93a4c7' font-size='11'>${maxRaw.toLocaleString()}</text><text x='${w-pR+5}' y='${pT+priceH}' fill='#93a4c7' font-size='11'>${minRaw.toLocaleString()}</text><text x='${pL}' y='${hPx-2}' fill='#f59e0b' font-size='11'>MA20</text><text x='${pL+42}' y='${hPx-2}' fill='#60a5fa' font-size='11'>MA60</text></svg>`;}
(async()=>{const sym=getSymbol();const d=await (await fetch('/api/report?t='+Date.now())).json();const list=[...(d.riskAdjustedRankings||[]),...(d.highReturnRankings||[])];const map=new Map();for(const x of list){if(!map.has(x.symbol))map.set(x.symbol,x);}const r=map.get(sym)||d.topPick;if(!r){document.getElementById('head').innerHTML='종목을 찾을 수 없습니다.';return;}document.getElementById('head').innerHTML=`<div class='h'>${r.symbol} (${r.name})</div><div class='muted'>종합점수 ${fmt(r.score)} / RR ${fmt(r.riskReward)} / 현재가 ${fmt(r.currentPrice)}</div>`;document.getElementById('quick').innerHTML=easyExplain(r);document.getElementById('plan').innerHTML=`<b>운용 플랜</b><br>진입: ${fmt(r.plan.entryZone[0])} ~ ${fmt(r.plan.entryZone[1])}<br>손절: ${fmt(r.plan.stopLoss)} / 익절1: ${fmt(r.plan.takeProfit1)} / 익절2: ${fmt(r.plan.takeProfit2)}<br>예상손실: ${pct(r.expectedLossPct)} / 예상수익(1차): ${pct(r.expectedReturnPct)} / 예상수익(2차): ${pct(r.expectedReturn2Pct)}<br>유효기간: ${r.plan.ttlTradingDays} 거래일<br>무효화 조건: ${r.plan.invalidationRule}`;document.getElementById('reasons').innerHTML=`<b>추천 근거 상세 설명</b><br><br>${longExplain(r)}<br><a href='${r.links?.analysis||'#'}' target='_blank'>리포트 원문(Analysis)</a> · <a href='${r.links?.news||'#'}' target='_blank'>관련 뉴스</a>`;try{const ch=await (await fetch(`/api/chart/${encodeURIComponent(sym)}?period=6mo&interval=1d`)).json();if(ch.ok)renderBigCandles(ch,document.getElementById('chartArea'));else document.getElementById('chartArea').innerHTML='차트 로딩 실패';}catch{document.getElementById('chartArea').innerHTML='차트 로딩 실패';}})();</script></body></html>